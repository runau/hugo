---
title: "ãƒªãƒ„ã‚¤ãƒ¼ãƒˆä¼ç”»botã‚’ä½œã£ã¦ twitterBotâ‘¦"
date: 2020-02-23T11:56:36+09:00
meta_image: "posts/meta_image/20200223_lunch.png"
tags: ["Python","twitter","aws","twitter_api"]
categories: ["twitter_api"]
---

ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ§˜5000äººã‚’è¨˜å¿µã—ã¦ã€ä¼ç”»botã‚’ä½œã‚Šã¾ã—ãŸã€‚

ä¼ç”»ãƒ„ã‚¤ãƒ¼ãƒˆã«ãƒªãƒ—ã—ã¦ãã‚ŒãŸã‚‰ã€å¾¡ç¤¼ã®ãƒªãƒ—ãƒ©ã‚¤ã¨ã€ãã®äººã®æœ€è¿‘ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’3ä»¶ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã‚ˆãƒ¼ï¼ã£ã¦ä¼ç”»w

é¢ç™½ã„ã£ã¦å‚åŠ ã—ã¦ãã ã•ã‚‹æ–¹ãŒãŸãã•ã‚“ã„ã¦ã€ã‚‚ã†ã™ã”ã„å¬‰ã—ã„//

é–‹å§‹ã‹ã‚‰3æ™‚é–“ãã‚‰ã„ã ã‘ã©ã€20äººãã‚‰ã„ã®æ–¹ã«å‚åŠ ã„ãŸã ã‘ã¦â€¦ã€‚

ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼

ã“ã“ã¾ã§ã®ä½œæˆéç¨‹ãªã‚“ã‹ã¯[ã“ã¡ã‚‰](../../categories/twitter-api/)ã€‚

{{< twitter id="1231358267516809216" >}}

ã§ã€å®Ÿéš›ã«ä½¿ã£ã¦ã‚‚ã‚‰ã†ã¨ãƒã‚°ãŒã§ã‚‹ã§ã‚‹ww

çŸ¥ã£ã¦ãŸã‘ã©w

ãªã®ã§ã€èª¿æ•´å…¥ã‚Œã¦ã„ãã¾ã™ï¼

## å„ç¨®ã‚¨ãƒ©ãƒ¼ã®å¯¾å¿œ

### åå‰ã®åˆ‡ã‚ŠæŠœã

twitterã£ã¦140æ–‡å­—ã—ã‹ã¤ã¶ã‚„ã‘ãªã„ã‚“ã§ã™ã­ã€‚

ãªã®ã§ã€ãã‚Œä»¥ä¸Šã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã“ã‚“ãªã‚¨ãƒ©ãƒ¼ãŒè¿”ã£ã¦ãã‚‹

```
{'errors': [{'code': 186, 'message': 'Tweet needs to be a bit shorter.'}]}
```

å¾¡ç¤¼ã®ãƒªãƒ—ãƒ©ã‚¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã“ã¡ã‚‰ã€‚

```py
status = f'{reply["name"]}ã•ã‚“ã€ä¼ç”»ã«å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\nãƒªãƒ—ã®å¾¡ç¤¼ã«{reply["name"]}ã•ã‚“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æœ€æ–°ã‹ã‚‰3ä»¶ã»ã©ã€RTã•ã›ã¦é ‚ãã¾ã™â™¡\nä½•å›ã§ã‚‚å‚åŠ å¯èƒ½ãªã®ã§ã€ã¾ãŸã®ã”å‚åŠ ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼\n\nâ€»ã“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã¯botã‹ã‚‰ã®è‡ªå‹•é€ä¿¡ã§ã™'
```

åå‰æŠœãã§ã€108æ–‡å­—ã‚‚ã‚ã‚‹ğŸ’¦

ãªã®ã§ã€è¨±å®¹ã§ãã‚‹æ–‡å­—æ•°ã¯15æ–‡å­—ã£ã¦ã¨ã“ã‚ã§ã™ã­ww

```py
    #åå‰ã®åˆ‡ã‚ŠæŠœã
    for idx,r in enumerate(replyList):
        name = replyList[idx]["name"]
        name = name.split("@")[0]
        name = name.split(" ")[0]
        name = name.split("ã€€")[0]
        name = name.split("ï½œ")[0]
        
        #ç©ºã«ãªã£ã¦ã—ã¾ã£ãŸã‚‰ã€å…ƒã€…ã®åå‰ã‚’å¾©æ´»
        if len(name) == 0:
            name = replyList[idx]["name"]

        #åˆ‡ã‚ŠæŠœã„ãŸçµæœofåˆ‡ã‚ŠæŠœã‘ãªã‹ã£ãŸçµæœ15æ–‡å­—ä»¥å†…ãªã‚‰æ–‡å­—æ•°ã§åˆ‡ã‚Šå–ã‚Š
        if len(name) <= 15:
            replyList[idx]["name"] = name
        else:
            replyList[idx]["name"] = f"{name[0:15]}â€¦"
```

ã§ã€ã“ã‚“ãªã®ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ãŸã€‚

ã‚„ã£ã±ã‚Šåå‰ã®åŒºåˆ‡ã‚Šæ–‡å­—ã§ä¸€ç•ªä½¿ã‚ã‚Œã¦ã‚‹ã®ã¯@ã§ã™ã‚ˆã­ã€‚

ã‚ã¨ã‚¹ãƒšãƒ¼ã‚¹ã¨ã‹ã€ãƒ¡ã‚¸ãƒ£ãƒ¼ãªåŒºåˆ‡ã‚Šæ–‡å­—ã®æ–¹ã¯ã—ã£ã‹ã‚ŠåŒºåˆ‡ã£ã¦ã‚ã’ã¾ã™ã€‚

ã§ã€åˆ‡ã‚Šå–ã‚Œãªã‹ã£ãŸäººã‚„ã€åˆ‡ã‚Šå–ã£ã¦ã‚‚é•·ã„äººã¯ã€15æ–‡å­—ã§ãƒã‚µãƒƒã¨åˆ‡ã£ã¦ã€ç•¥ã—ã¦ã‚‹ã‚ˆãƒ¼ã£ã¦ä¼ãˆã‚‹ãŸã‚ã«wç‚¹ã‚’ãã£ã¤ã‘ã¦ãŠãã¾ã™ï¼

ã¯ã„ã€å®Œæˆã€‚

### ãƒ„ã‚¤ãƒ¼ãƒˆãŒæ¤œå‡ºå‡ºæ¥ãªã„äººã¸ã®å¯¾å¿œ

Twitterã£ã¦è«å¤§ãªé‡ã®ãƒ„ã‚¤ãƒ¼ãƒˆãŒè“„ç©ã•ã‚Œã‚‹ã‹ã‚‰ã€ç§ãŸã¡ä¸€èˆ¬äººãŒapiã‚’ä½¿ã†ã¨æœ€è¿‘ä¸€é€±é–“åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã—ã‹å–ã‚Œãªã„ã€‚ã¿ãŸã„ãªåˆ¶é™ãŒã‚ã‚‹ã‚“ã§ã™ã£ã¦ã€‚

ã‚ã‚“ã¾ã‚Šãƒ„ã‚¤ãƒ¼ãƒˆã—ãªã„äººã ã¨ã€3ãƒ„ã‚¤ãƒ¼ãƒˆã‚‚å–å¾—ã§ããªã„ww

ã§ã€ã†ã‚“ã€ã“ã‚Œã¯ã‚‚ã¯ã‚„ãŸã ã®ãƒã‚°ã§ã™ãŒâ€¦ã€‚

```
Traceback (most recent call last):
  File "/var/task/lambda_function.py", line 165, in lambda_handler
    main()
  File "/var/task/lambda_function.py", line 155, in main
    print(f'{reply["tweetIdList"][idx]}ã‚’ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ')
IndexError: list index out of range
```

ã¯ãâ€¦ã€‚

ãªã„é…åˆ—å–ã‚ã†ã¨ã—ã¦ã¾ã™ã‹ã‚‰ã­â€¦ã€‚ç´ äººã‹ã£ã¦ã„ã†ã­â€¦ã€‚

```py
    if idx >= len(reply["tweetIdList"]):
        break
```

ã¯ã„ã€‚åˆ¶å¾¡ã‹ã‘ã¾ã—ãŸã‚ˆâ€¦ã€‚

## å„ç¨®æ”¹å–„

### waitè¿½åŠ 

ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã¨ãƒªãƒ—ãƒ©ã‚¤ã‚’ã—ã¦ã„ã‚‹ã‚ã‘ãªã®ã§ã™ãŒã€waitã‚‚ã„ã‚Œãšã«ãƒã‚·ãƒã‚·ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã®ã¯ã©ã†ãªã®ã‚ˆï¼Ÿ

ã£ã¦æ€ã£ãŸã®ã§ã€waitè¿½åŠ ã—ã¾ã—ãŸã€‚

```
    sleepTime = random.random() * 20
    print(sleepTime)
    time.sleep(sleepTime)
```

ã–ã¤ãƒ¼ãªæ„Ÿã˜w

0ï½1ã®ä¹±æ•°ã«20æ›ã‘ã¦ã‚‹ã‹ã‚‰ã€0ç§’ã‹ã‚‰20ç§’waitã—ã¾ã™ã€‚

### ngã«ãªã£ãŸäººã¸ã®ãƒªãƒ—ãƒ©ã‚¤

å¤‰ãªãƒ„ã‚¤ãƒ¼ãƒˆã‚’ãƒªãƒ—ãƒ©ã‚¤ã—ãŸããªã„ã®ã§ã€æœ€ä½é™ã®ãƒã‚§ãƒƒã‚¯ã‚’æ›ã‘ã¦ã„ãŸã‚“ã§ã™ãŒã€ãã†ã™ã‚‹ã¨ã€ãƒã‚§ãƒƒã‚¯ã«å¼•ã£ã‹ã‹ã£ã¦ãƒªãƒ—ãƒ©ã‚¤ã•ã‚Œã¦ãªã„ã®ã‹ã€ãªã‚“ã‚‰ã‹ã®ãˆã‚‰ãƒ¼ãªã®ã‹ãŒåˆ†ã‹ã‚‰ãªã„â€¦ã€‚

å›°ã‚‹ã®ã§ã€ã‚ãªãŸã¯ngã®ãŸã‚ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã§ãã¾ã›ã‚“ã£ã¦ã„ã†ãƒªãƒ—ãƒ©ã‚¤ã‚’ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚

```py
    if reply["ng"]:
        status = f'{reply["name"]}ã•ã‚“ã€ä¼ç”»ã«å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\nå¤§å¤‰ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€{reply["ngReason"]}ã®ãŸã‚ã€{reply["name"]}ã•ã‚“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã¯RTã§ãã¾ã›ã‚“ã€‚\n\nâ€»ã“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã¯botã‹ã‚‰ã®è‡ªå‹•é€ä¿¡ã§ã™'
    else:
        status = f'{reply["name"]}ã•ã‚“ã€ä¼ç”»ã«å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\nãƒªãƒ—ã®å¾¡ç¤¼ã«{reply["name"]}ã•ã‚“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æœ€æ–°ã‹ã‚‰3ä»¶ã»ã©ã€RTã•ã›ã¦é ‚ãã¾ã™â™¡\nä½•å›ã§ã‚‚å‚åŠ å¯èƒ½ãªã®ã§ã€ã¾ãŸã®ã”å‚åŠ ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼\n\nâ€»ã“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã¯botã‹ã‚‰ã®è‡ªå‹•é€ä¿¡ã§ã™'
```

ã“ã‚“ãªæ„Ÿã˜

## å®Œæˆï¼

githubã«ã‚‚å¾Œã§ä¸Šã’ã¾ã™ãƒ¼

```py:lambda_function.py
from requests_oauthlib import OAuth1Session, OAuth1
import requests
import json
import codecs
import time
import os
import datetime
import collections
import re
import random

OAUTH1 = os.environ['OAUTH1']
OAUTH2 = os.environ['OAUTH2']
OAUTH3 = os.environ['OAUTH3']
OAUTH4 = os.environ['OAUTH4']
SCREEN_NAME = os.environ['SCREEN_NAME']

def getOauth():
    return OAuth1(OAUTH1, OAUTH2, OAUTH3, OAUTH4)

def main():

    ngList=["èè³‡",'è£å¢','xxx','yyy'] #ãƒ–ãƒ­ã‚°ã‚’æ±šã—ãŸããªã„ã‹ã‚‰æ›¸ã„ã¦ã„ãªã„ã‘ã©ã€å®Ÿéš›ã«ã¯ã€ã‚ã¨100ãƒ¯ãƒ¼ãƒ‰ãã‚‰ã„ã‚ã‚Šã¾ã™www

    #è‡ªåˆ†å®›ã®ãƒªãƒ—ãƒ©ã‚¤æœ€æ–°ã‹ã‚‰10ä»¶ã‚’å…¨ã¦å–å¾—
    response = requests.get(
        f'https://api.twitter.com/1.1/statuses/mentions_timeline.json?count=20',
        auth=getOauth()
    ).json()

    #ãã®ä¸­ã‹ã‚‰ã€æŒ‡å®šã—ãŸå…ƒãƒ„ã‚¤ãƒ¼ãƒˆã«å¯¾ã—ã¦ã®ãƒªãƒ—ãƒ©ã‚¤ã®ã¿ã«çµã‚Šè¾¼ã‚€
    in_reply_to_status_id=1231358267516809216
    response = list(filter(lambda x:x["in_reply_to_status_id"] == in_reply_to_status_id,response))

    #æœªãƒªãƒ—ãƒ©ã‚¤ã®ç‰©ã®ã¿ã«çµã‚Šè¾¼ã‚€
    doneList = requests.get(
        f'https://api.twitter.com/1.1/statuses/user_timeline.json?screen_name={SCREEN_NAME}&count=100',
        auth=getOauth()
    ).json()
    doneList = list(map(lambda x:x["in_reply_to_status_id"],doneList))
    print(doneList)
    
    response = list(filter(lambda x:x["id"] not in doneList,response))
    print(response)

    #æ‰±ã„ã‚„ã™ã„ã‚ˆã†ã«æˆå‹
    replyList = list(map(lambda x:{"id":x["user"]["id"],"name":x["user"]["name"],"profile":x["user"]["description"],"replyId":x["id"],"ng":False},response))
    print(replyList)
    
    #åå‰ã®åˆ‡ã‚ŠæŠœã
    for idx,r in enumerate(replyList):
        name = replyList[idx]["name"]
        name = name.split("@")[0]
        name = name.split("ï½œ")[0]
        
        #ç©ºã«ãªã£ã¦ã—ã¾ã£ãŸã‚‰ã€å…ƒã€…ã®åå‰ã‚’å¾©æ´»
        if len(name) == 0:
            name = replyList[idx]["name"]

        #åˆ‡ã‚ŠæŠœã„ãŸçµæœofåˆ‡ã‚ŠæŠœã‘ãªã‹ã£ãŸçµæœ15æ–‡å­—ä»¥å†…ãªã‚‰æ–‡å­—æ•°ã§åˆ‡ã‚Šå–ã‚Š
        if len(name) <= 15:
            replyList[idx]["name"] = name
        else:
            replyList[idx]["name"] = f"{name[0:15]}â€¦"

    #æœ€æ–°ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’10ä»¶å–å¾—ã™ã‚‹
    option = 'count=10&exclude_replies=true&include_rts=false'
    for idx,r in enumerate(replyList):
        user_timeline = requests.get(
            f'https://api.twitter.com/1.1/statuses/user_timeline.json?id={r["id"]}&{option}',
            auth=getOauth()
        ).json()
        replyList[idx]["tweetList"] = list(map(lambda x:x["text"],user_timeline))
        replyList[idx]["tweetIdList"] = list(map(lambda x:x["id"],user_timeline))
    print(replyList)

    #NGãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
    print("NGãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯")
    for idx,reply in enumerate(replyList):
        #ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
        if len(list(filter(lambda ng:ng in reply["profile"],ngList))):
            print(f"{reply['name']}:ng")
            print(list(filter(lambda ng:ng in reply["profile"],ngList)))
            replyList[idx]["ng"] = True
            replyList[idx]["ngReason"] = "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«NGãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹"
        elif len(list(filter(lambda x:len(list(filter(lambda ng:ng in x,ngList))),reply["tweetList"]))):
            print(f"{reply['name']}:ng")
            print(list(filter(lambda x:len(list(filter(lambda ng:ng in x,ngList))),reply["tweetList"])))
            replyList[idx]["ng"] = True
            replyList[idx]["ngReason"] = "ãƒ„ã‚¤ãƒ¼ãƒˆã«NGãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹"
        else:
            print(f"{reply['name']}:ok")

    #ãƒªãƒ³ã‚¯æ•°ãƒã‚§ãƒƒã‚¯
    print("ãƒªãƒ³ã‚¯æ•°ãƒã‚§ãƒƒã‚¯")
    for idx,reply in enumerate(replyList):
        #ãƒ„ã‚¤ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
        if len(list(filter(lambda x:x.count("http")>=2,reply["tweetList"]))):
            print(f"{reply['name']}:ng")
            replyList[idx]["ng"] = True
            replyList[idx]["ngReason"] = "ãƒ„ã‚¤ãƒ¼ãƒˆã«éå‰°ãªãƒªãƒ³ã‚¯ãŒã‚ã‚‹"
        else:
            print(f"{reply['name']}:ok")

    #é‡è¤‡ãƒªãƒ³ã‚¯æ•°ãƒã‚§ãƒƒã‚¯
    print("é‡è¤‡ãƒªãƒ³ã‚¯æ•°ãƒã‚§ãƒƒã‚¯")
    pattern = "https?://[\w/:%#\$&\?\(\)~\.=\+\-]+"
    for idx,reply in enumerate(replyList):
        #urlã‚’æŠ½å‡º â€»æ—¢ã«1ãƒ„ã‚¤ãƒ¼ãƒˆå†…ã«è¤‡æ•°urlã‚ã‚‹å ´åˆã¯é™¤å¤–ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã«æ¥ãŸæ™‚ã«ã¯ã€å¿…ãš1ãƒ„ã‚¤ãƒ¼ãƒˆ0ï½1url
        #ã¾ãšurlã‚’å«ã‚€ã‚‚ã®ã ã‘ã«çµã‚‹
        urlTweetList =list(filter(lambda x:x.count("http")==1,reply["tweetList"]))
        print(f"urlTweetList:{urlTweetList}")
        #urlã‚’æŠ½å‡º
        urlList = list(map(lambda x:re.findall(pattern, x)[0],urlTweetList))
        print(f"urlList:{urlList}")
        #urlListã®ãã‚Œãã‚Œã®urlã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ãã‚Œã‚‹ â€»è¦import collections
        counter = collections.Counter(urlList)
        print(f"counter:{counter}")

        if len(list(filter(lambda x:x >= 3,counter.values()))):
            print(f"{reply['name']}:ng")
            replyList[idx]["ng"] = True
            replyList[idx]["ngReason"] = "ãƒ„ã‚¤ãƒ¼ãƒˆã«éå‰°ãªé‡è¤‡ãƒªãƒ³ã‚¯ãŒã‚ã‚‹"
        else:
            print(f"{reply['name']}:ok")

    warnList = ["RTä¼ç”»","å›ºå®šãƒ„ã‚¤ãƒ¼ãƒˆ","å›ºãƒ„ã‚¤","ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ"]
    #RTä¼ç”»æ•°ãƒã‚§ãƒƒã‚¯
    print("RTä¼ç”»æ•°ãƒã‚§ãƒƒã‚¯")
    for idx,reply in enumerate(replyList):
        if len(list(filter(lambda x:len(list(filter(lambda warn:warn in x,warnList))),reply["tweetList"]))) >= 3:
            print(f"{reply['name']}:ng")
            replyList[idx]["ng"] = True
            replyList[idx]["ngReason"] = "éå‰°ãªRTä¼ç”»ãƒ„ã‚¤ãƒ¼ãƒˆãŒã‚ã‚‹"
        else:
            print(f"{reply['name']}:ok")

    #æ—¥æœ¬èªãƒã‚§ãƒƒã‚¯
    print("æ—¥æœ¬èªãƒã‚§ãƒƒã‚¯")
    pattern = "[\u3041-\u309F]+" #ã²ã‚‰ãŒãª
    for idx,reply in enumerate(replyList):
        print(re.findall(pattern, reply["profile"]))
        if len(re.findall(pattern, reply["profile"])) == 0:
            print(f"{reply['name']}:ng")
            replyList[idx]["ng"] = True
            replyList[idx]["ngReason"] = "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‹ã‚‰æ—¥æœ¬èªãŒæ¤œå‡ºã§ããªã„"
        else:
            print(f"{reply['name']}:ok")

    #ãƒªãƒ—ãƒ©ã‚¤ã™ã‚‹
    for reply in replyList:
        if reply["ng"]:
            status = f'{reply["name"]}ã•ã‚“ã€ä¼ç”»ã«å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\nå¤§å¤‰ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€{reply["ngReason"]}ã®ãŸã‚ã€{reply["name"]}ã•ã‚“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã¯RTã§ãã¾ã›ã‚“ã€‚\n\nâ€»ã“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã¯botã‹ã‚‰ã®è‡ªå‹•é€ä¿¡ã§ã™'
        else:
            status = f'{reply["name"]}ã•ã‚“ã€ä¼ç”»ã«å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\nãƒªãƒ—ã®å¾¡ç¤¼ã«{reply["name"]}ã•ã‚“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æœ€æ–°ã‹ã‚‰3ä»¶ã»ã©ã€RTã•ã›ã¦é ‚ãã¾ã™â™¡\nä½•å›ã§ã‚‚å‚åŠ å¯èƒ½ãªã®ã§ã€ã¾ãŸã®ã”å‚åŠ ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼\n\nâ€»ã“ã®ãƒ„ã‚¤ãƒ¼ãƒˆã¯botã‹ã‚‰ã®è‡ªå‹•é€ä¿¡ã§ã™'
        in_reply_to_status_id = reply["replyId"]
        print(f"in_reply_to_status_id:{in_reply_to_status_id} exec")
        replyResponse = requests.post(
            f'https://api.twitter.com/1.1/statuses/update.json',
            data={"status":status
                ,"in_reply_to_status_id":in_reply_to_status_id
                ,"auto_populate_reply_metadata":True},
            auth=getOauth()
        ).json()
        print(replyResponse)

        #ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹
        if not reply["ng"]:
            for idx in range(3):
                if idx >= len(reply["tweetIdList"]):
                    break
                sleepTime = random.random() * 20
                print(sleepTime)
                time.sleep(sleepTime)

                print(f'{reply["tweetIdList"][idx]}ã‚’ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ')
                response = requests.post(
                    f'https://api.twitter.com/1.1/statuses/retweet/{reply["tweetIdList"][idx]}.json',
                    auth=getOauth()
                ).json()
                print(response)

def lambda_handler(event, context):

    try:
        main()

    except:
        import traceback
        traceback.print_exc()

```

ã¾ã ã¾ã ã€ãƒªãƒ—ãŠå¾…ã¡ã—ã¦ã¾ã™ãƒ¼//