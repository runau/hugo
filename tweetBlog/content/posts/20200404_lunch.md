---
title: "マイ請求ダッシュボードをrootユーザー以外が見れるようにする"
date: 2020-04-04T15:00:21+09:00
meta_image: "posts/meta_image/20200404_lunch.png"
tags: 
    - aws
    - role
categories: 
    - 検証
description: "毎朝起きると、前日に何か設定の失敗や想定外のバグで、請求額が増えていないかを確認するのが日課です。前にdynamoDBで失敗して、気が付いたら数千円かかってしまっていたことがあったから、心配で…wwでも、この確認。rootユーザーでしか見れなくて…。"
---

毎朝起きると、前日に何か設定の失敗や想定外のバグで、請求額が増えていないかを確認するのが日課です。

前にdynamoDBで失敗して、気が付いたら数千円かかってしまっていたことがあったから、心配で…ww

でも、この確認。rootユーザーでしか見れなくて…。

一応、監視アカウントに権限付けてみたんだけど、それだけじゃだめみたいなんですね。

で、ようやくちゃんと設定しました。

## 現状

rootユーザー以外でマイ請求ダッシュボードを開くと、こんな感じのエラーが出ます。

![マイ請求ダッシュボード](../img/bill-iam5.png)

> アクセス権限が必要です。
> このアカウントの請求情報にアクセスするためのアクセス権限がありません。サポートが必要な場合は、AWS 管理者に連絡してください。AWS 管理者は、(1) このアカウントが IAM およびフェデレーティッドユーザーに対して請求情報へのアクセスを許可できること]、および (2) 必要な IAM アクセス権限を持っていること]を確認して、ユーザーまたはグループにアクセス権限を付与できます。

で、エラー内容に書いてある通り、**IAMに対して請求情報へのアクセスを許可する**ことと、**アクセス権限をつける**事が必要みたいです。

↑のエラーに書いてあった[AWS公式の設定方法](https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/control-access-billing.html#ControllingAccessWebsite-Activate
)に沿って作業していきます。

## アクセス権限をつける

すでに付けてあったけど、改めて。

ポリシーはこんな感じで設定してあります。

付けるのは`aws-portal:ViewBilling`だけ。

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "aws-portal:ViewBilling"
            ],
            "Resource": "*"
        }
    ]
}
```


## IAMに対して請求情報へのアクセスを許可する

rootユーザーでログインして、右上のアカウントをクリック。

で、「マイアカウント」から、それぞれ下の通りにクリックしていく。

![マイ請求ダッシュボード](../img/bill-iam1.png)

![マイ請求ダッシュボード](../img/bill-iam2.png)

で、IAMユーザー/ロールによる請求情報へのアクセスをアクティブ化します。

![マイ請求ダッシュボード](../img/bill-iam3.png)

で、一度ログアウトして、監視ユーザーでログイン。

マイ請求ダッシュボードを開く。

![マイ請求ダッシュボード](../img/bill-iam4.png)

ちゃんと表示できた！

でも、支払い方法とかは、表示されないようになってる！

![マイ請求ダッシュボード](../img/bill-iam6.png)

いい感じ//